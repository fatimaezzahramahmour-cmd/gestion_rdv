{% extends 'rdv/base.html' %}

{% block title %}File d'attente — Agent{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">File d'attente</h1>
  <a class="btn btn-secondary btn-custom btn-secondary-custom" href="{% url 'agent_dashboard' %}">← Accueil agent</a>
</div>

{% if messages %}
  <div class="mb-3">
    {% for m in messages %}
      <div class="alert alert-success alert-custom mb-2">{{ m }}</div>
    {% endfor %}
  </div>
{% endif %}

{% if queue_entries %}
  <p class="text-muted mb-4">Cliquez sur « Confirmer passage chez le médecin » quand le patient est passé en cabinet.</p>
  <div class="rdv-list">
    {% for entry in queue_entries %}
      <div class="rdv-item card-custom">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2">
          <div>
            <h5 class="rdv-item-title mb-1">Patient numéro {{ entry.position }} : {{ entry.label }}</h5>
            <span class="rdv-item-date">{{ entry.rdv.date }}</span>
            {% if entry.rdv.titre %}<span class="text-muted"> — {{ entry.rdv.titre }}</span>{% endif %}
            {% if entry.rdv.service %}<span class="text-muted"> ({{ entry.rdv.service.nom }})</span>{% endif %}
          </div>
          <div>
            <form method="post" action="{% url 'rdv_valider' entry.rdv.pk %}" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="next" value="file_attente">
              <button type="submit" class="btn btn-success btn-custom btn-success-custom">Confirmer passage chez le médecin</button>
            </form>
          </div>
        </div>
        <div class="d-flex gap-1 flex-wrap mt-2">
          <span class="badge badge-custom badge-{% if entry.rdv.priority == 'urgent' %}urgent{% else %}normal{% endif %}">{{ entry.rdv.priority }}</span>
          <span class="badge bg-secondary">Pas encore passé</span>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty-state card-custom">
    <div class="empty-state-icon"></div>
    <p class="mb-3">Aucun patient en attente dans la file.</p>
    <a class="btn btn-primary btn-custom btn-primary-custom" href="{% url 'agent_dashboard' %}">Retour à l'accueil agent</a>
  </div>
{% endif %}
{% endblock %}
